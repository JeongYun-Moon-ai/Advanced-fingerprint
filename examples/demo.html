<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Fingerprinting v3 - 97% Accuracy Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0d1117 0%, #161b22 100%);
            min-height: 100vh;
            color: #c9d1d9;
            padding: 1rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            font-size: 1.8rem;
            background: linear-gradient(90deg, #58a6ff, #3fb950, #f0883e);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.25rem;
        }

        .subtitle {
            text-align: center;
            color: #8b949e;
            font-size: 0.85rem;
            margin-bottom: 1rem;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1rem;
        }

        .card {
            background: rgba(22, 27, 34, 0.9);
            border: 1px solid #30363d;
            border-radius: 10px;
            padding: 1rem;
        }

        .card h2 {
            font-size: 0.95rem;
            margin-bottom: 0.75rem;
            color: #58a6ff;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.65rem;
            font-weight: 600;
        }

        .v1 {
            background: rgba(63, 185, 80, 0.2);
            color: #3fb950;
        }

        .v2 {
            background: rgba(88, 166, 255, 0.2);
            color: #58a6ff;
        }

        .v3 {
            background: rgba(240, 136, 62, 0.2);
            color: #f0883e;
        }

        .tech-list {
            list-style: none;
            font-size: 0.75rem;
        }

        .tech-list li {
            padding: 0.3rem 0;
            border-bottom: 1px solid #21262d;
            display: flex;
            justify-content: space-between;
        }

        .tech-list li:last-child {
            border-bottom: none;
        }

        .layer-title {
            color: #f0883e;
            font-weight: 600;
            margin-top: 0.5rem;
            margin-bottom: 0.25rem;
            font-size: 0.7rem;
        }

        .btn {
            background: linear-gradient(135deg, #238636, #2ea043);
            border: none;
            padding: 0.6rem 1rem;
            border-radius: 6px;
            color: #fff;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-top: 0.5rem;
            font-size: 0.85rem;
        }

        .btn:hover {
            filter: brightness(1.1);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn.secondary {
            background: #30363d;
        }

        .btn.orange {
            background: linear-gradient(135deg, #f0883e, #d29922);
        }

        .result {
            display: none;
            margin-top: 0.75rem;
        }

        .result.active {
            display: block;
        }

        .result-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.4rem;
            font-size: 0.75rem;
        }

        .result-item {
            background: #0d1117;
            padding: 0.4rem;
            border-radius: 4px;
        }

        .result-label {
            color: #8b949e;
            font-size: 0.65rem;
        }

        .result-value {
            color: #3fb950;
            font-family: monospace;
            word-break: break-all;
            font-size: 0.7rem;
        }

        .hash-display {
            background: #0d1117;
            padding: 0.5rem;
            border-radius: 6px;
            font-family: monospace;
            font-size: 0.65rem;
            color: #58a6ff;
            word-break: break-all;
        }

        .meter {
            height: 6px;
            background: #21262d;
            border-radius: 3px;
            margin-top: 0.2rem;
        }

        .meter-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s;
        }

        .meter-fill.green {
            background: linear-gradient(90deg, #238636, #3fb950);
        }

        .meter-fill.orange {
            background: linear-gradient(90deg, #d29922, #f0883e);
        }

        .accuracy-display {
            text-align: center;
            padding: 1rem;
            background: linear-gradient(135deg, rgba(63, 185, 80, 0.1), rgba(88, 166, 255, 0.1));
            border-radius: 8px;
            margin-top: 0.5rem;
        }

        .accuracy-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #3fb950;
        }

        .accuracy-label {
            font-size: 0.75rem;
            color: #8b949e;
        }

        textarea {
            width: 100%;
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 0.5rem;
            color: #c9d1d9;
            font-family: monospace;
            resize: none;
            height: 60px;
            font-size: 0.8rem;
        }

        textarea:focus {
            outline: none;
            border-color: #58a6ff;
        }

        .loading {
            text-align: center;
            padding: 1rem;
            display: none;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 3px solid #21262d;
            border-top: 3px solid #58a6ff;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            margin: 0 auto 0.5rem;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .module-tag {
            display: inline-block;
            padding: 2px 6px;
            margin: 2px;
            border-radius: 4px;
            font-size: 0.6rem;
            background: #21262d;
            color: #8b949e;
        }

        .module-tag.active {
            background: rgba(63, 185, 80, 0.2);
            color: #3fb950;
        }

        .warning-box {
            background: rgba(210, 153, 34, 0.1);
            border: 1px solid rgba(210, 153, 34, 0.3);
            border-radius: 6px;
            padding: 0.5rem;
            font-size: 0.7rem;
            margin-top: 0.5rem;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Advanced Fingerprinting v3</h1>
        <p class="subtitle">97% Max Accuracy - 28 Hardware Signals + 5-Layer Persistence</p>

        <div class="grid">
            <!-- Signal Overview -->
            <div class="card">
                <h2>Hardware Signals (v3)</h2>

                <div class="layer-title">v1 Basic (8 signals)</div>
                <ul class="tech-list">
                    <li><span>GPU Renderer</span><span class="badge v1">10%</span></li>
                    <li><span>Shader Precision</span><span class="badge v1">5%</span></li>
                    <li><span>Screen Resolution</span><span class="badge v1">5%</span></li>
                    <li><span>Hardware Concurrency</span><span class="badge v1">3%</span></li>
                    <li><span>Timezone</span><span class="badge v1">3%</span></li>
                    <li><span>WebGL Max Texture</span><span class="badge v1">3%</span></li>
                    <li><span>GPU Vendor</span><span class="badge v1">2%</span></li>
                    <li><span>Platform</span><span class="badge v1">2%</span></li>
                </ul>

                <div class="layer-title">v2 Enhanced (8 signals)</div>
                <ul class="tech-list">
                    <li><span>Math Engine</span><span class="badge v2">5%</span></li>
                    <li><span>Font Fingerprint</span><span class="badge v2">5%</span></li>
                    <li><span>WebGL Render</span><span class="badge v2">4%</span></li>
                    <li><span>CSS Features</span><span class="badge v2">3%</span></li>
                    <li><span>Intl API</span><span class="badge v2">3%</span></li>
                    <li><span>Audio Stack</span><span class="badge v2">3%</span></li>
                    <li><span>WebGL2 Params</span><span class="badge v2">3%</span></li>
                    <li><span>Media Capabilities</span><span class="badge v2">2%</span></li>
                </ul>

                <div class="layer-title">v3 Device Uniqueness (4 signals)</div>
                <ul class="tech-list">
                    <li><span>GPU Silicon (Manufacturing)</span><span class="badge v3">12%</span></li>
                    <li><span>Audio DAC Hardware</span><span class="badge v3">10%</span></li>
                    <li><span>Canvas Micro Rendering</span><span class="badge v3">8%</span></li>
                    <li><span>Storage Profile</span><span class="badge v3">4%</span></li>
                </ul>

                <div class="layer-title">Persistence Layer</div>
                <ul class="tech-list">
                    <li><span>localStorage + sessionStorage</span><span class="badge v2">persist</span></li>
                    <li><span>Cookie (400d) + IndexedDB</span><span class="badge v2">persist</span></li>
                    <li><span>Cache API</span><span class="badge v2">persist</span></li>
                </ul>
            </div>

            <!-- Keystroke -->
            <div class="card">
                <h2>Keystroke Collection</h2>
                <textarea id="typingArea" placeholder="Type anything here..."></textarea>
                <div id="keystrokeStats" style="margin-top:0.25rem;font-size:0.75rem;color:#8b949e;"></div>

                <div class="warning-box">
                    Permissions needed: PRNU (camera), Gait (motion sensor), Geolocation, IP (network)
                </div>
            </div>

            <!-- Fingerprint Generation -->
            <div class="card">
                <h2>Generate Fingerprint</h2>
                <button class="btn" id="requestPermBtn">1. Request Sensor Permission</button>
                <button class="btn secondary" id="generateBtn" disabled>2. Basic Fingerprint</button>
                <button class="btn orange" id="generateFullBtn" disabled>3. Full v3 (97% max)</button>

                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p style="font-size:0.8rem;">Collecting hardware signals... (up to 5s)</p>
                </div>

                <div class="result" id="resultSection">
                    <div class="accuracy-display">
                        <div class="accuracy-number" id="accuracyValue">0%</div>
                        <div class="accuracy-label">Estimated Accuracy</div>
                    </div>
                    <div style="margin-top:0.5rem;">
                        <div class="result-label">Hash</div>
                        <div class="hash-display" id="hashValue">-</div>
                    </div>
                    <div style="margin-top:0.3rem;">
                        <div class="result-label">Previous Hash (Persistence)</div>
                        <div class="hash-display" id="prevHashValue" style="color:#f0883e;">-</div>
                    </div>
                    <div class="result-grid" style="margin-top:0.5rem;">
                        <div class="result-item">
                            <div class="result-label">Confidence</div>
                            <div class="result-value" id="confidenceValue">-</div>
                            <div class="meter">
                                <div class="meter-fill green" id="confidenceMeter" style="width:0%"></div>
                            </div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Stability</div>
                            <div class="result-value" id="stabilityValue">-</div>
                            <div class="meter">
                                <div class="meter-fill orange" id="stabilityMeter" style="width:0%"></div>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top:0.5rem;">
                        <div class="result-label">Active Modules</div>
                        <div id="moduleTags"></div>
                    </div>
                </div>
            </div>

            <!-- Details -->
            <div class="card" id="detailsCard" style="display:none; grid-column:1/-1;">
                <h2>Signal Details</h2>
                <div class="result-grid" id="detailsGrid"></div>
            </div>
        </div>
    </div>

    <script src="../packages/web/dist/index.umd.min.js"></script>
    <script>
        // Use the SDK if available, otherwise fallback to inline implementation
        const SDK = window.AdvancedFingerprinting;

        async function createFingerprinter() {
            if (SDK && SDK.Fingerprinter) {
                return new SDK.Fingerprinter({ debug: true });
            }
            // Fallback: basic inline fingerprinter
            return createFallbackFingerprinter();
        }

        function createFallbackFingerprinter() {
            return {
                tracker: { keyTimings: [], keyDownTimes: new Map(), getKeystroke() {
                    const t = this.keyTimings;
                    if (t.length < 2) return { avgDwell: 0, avgFlight: 0, rhythm: [], wpm: 0 };
                    const dwells = t.map(x => x.up - x.down);
                    const flights = [];
                    for (let i = 1; i < t.length; i++) flights.push(t[i].down - t[i - 1].up);
                    const totalTime = t[t.length - 1].up - t[0].down;
                    return { avgDwell: dwells.reduce((a,b)=>a+b,0)/dwells.length, avgFlight: flights.length ? flights.reduce((a,b)=>a+b,0)/flights.length : 0, rhythm: dwells.slice(0,10), wpm: totalTime > 0 ? (t.length/5)/(totalTime/60000) : 0 };
                }},
                async requestPermissions() {
                    if (typeof DeviceMotionEvent?.requestPermission === 'function') {
                        try { return await DeviceMotionEvent.requestPermission() === 'granted'; } catch { return false; }
                    }
                    return true;
                },
                async generate(options) {
                    // Use SDK's getFingerprint if available
                    if (SDK && SDK.getFingerprint) {
                        return SDK.getFingerprint(options);
                    }
                    return { hash: 'SDK not loaded', accuracy: 0, modules: [], signals: {}, details: {} };
                }
            };
        }

        // Initialize
        (async () => {
            const fp = await createFingerprinter();

            // Keystroke tracking
            document.addEventListener('keydown', e => {
                if (!fp.tracker.keyDownTimes.has(e.key)) fp.tracker.keyDownTimes.set(e.key, performance.now());
            });
            document.addEventListener('keyup', e => {
                const d = fp.tracker.keyDownTimes.get(e.key);
                if (d) { fp.tracker.keyTimings.push({ down: d, up: performance.now(), key: e.key }); fp.tracker.keyDownTimes.delete(e.key); }
            });

            document.getElementById('requestPermBtn').onclick = async () => {
                const granted = await fp.requestPermissions();
                document.getElementById('requestPermBtn').textContent = granted ? 'Permission Granted' : 'Permission Denied (continue)';
                document.getElementById('generateBtn').disabled = false;
                document.getElementById('generateFullBtn').disabled = false;
            };

            document.getElementById('generateBtn').onclick = () => runFingerprint(false);
            document.getElementById('generateFullBtn').onclick = () => runFingerprint(true);

            async function runFingerprint(full) {
                document.getElementById('generateBtn').disabled = true;
                document.getElementById('generateFullBtn').disabled = true;
                document.getElementById('loading').classList.add('active');
                document.getElementById('resultSection').classList.remove('active');
                document.getElementById('detailsCard').style.display = 'none';

                try {
                    const result = await fp.generate({
                        enablePRNU: full,
                        enableGait: full,
                        enableGeolocation: full,
                        debug: true,
                    });

                    document.getElementById('hashValue').textContent = result.hash;
                    document.getElementById('prevHashValue').textContent = result.previousHash || '(none)';
                    document.getElementById('accuracyValue').textContent = (result.accuracy * 100).toFixed(0) + '%';

                    const confidence = result.confidence || (result.accuracy * 0.95);
                    const stability = result.stability || 0.9;
                    document.getElementById('confidenceValue').textContent = ((typeof confidence === 'number' ? confidence : 0) * 100).toFixed(1) + '%';
                    document.getElementById('confidenceMeter').style.width = ((typeof confidence === 'number' ? confidence : 0) * 100) + '%';
                    document.getElementById('stabilityValue').textContent = ((typeof stability === 'number' ? stability : 0) * 100).toFixed(1) + '%';
                    document.getElementById('stabilityMeter').style.width = ((typeof stability === 'number' ? stability : 0) * 100) + '%';

                    document.getElementById('moduleTags').innerHTML = (result.modules || []).map(m =>
                        '<span class="module-tag active">' + m + '</span>'
                    ).join('');

                    // Signal details
                    const grid = document.getElementById('detailsGrid');
                    grid.innerHTML = '';
                    const add = (l, v) => { grid.innerHTML += '<div class="result-item"><div class="result-label">' + l + '</div><div class="result-value">' + v + '</div></div>'; };

                    const s = result.signals || {};
                    if (s.gpuRenderer) add('GPU Renderer', s.gpuRenderer);
                    if (s.gpuVendor) add('GPU Vendor', s.gpuVendor);
                    if (s.screenResolution) add('Screen', s.screenResolution);
                    if (s.hardwareConcurrency) add('CPU Cores', s.hardwareConcurrency);
                    if (s.timezone) add('Timezone', s.timezone);
                    if (s.platform) add('Platform', s.platform);
                    if (s.shaderPrecision) add('Shader Precision', s.shaderPrecision.substring(0, 40) + '...');
                    if (s.mathEngineHash) add('Math Engine (v2)', s.mathEngineHash.substring(0, 16) + '...');
                    if (s.fontHash) add('Font Hash (v2)', s.fontHash.substring(0, 16) + '...');
                    if (s.webglRenderHash) add('WebGL Render (v2)', s.webglRenderHash.substring(0, 16) + '...');
                    if (s.audioStackHash) add('Audio Stack (v2)', s.audioStackHash.substring(0, 16) + '...');
                    if (s.gpuSiliconHash) add('GPU Silicon (v3)', s.gpuSiliconHash.substring(0, 16) + '...');
                    if (s.audioHardwareHash) add('Audio DAC (v3)', s.audioHardwareHash.substring(0, 16) + '...');
                    if (s.canvasMicroHash) add('Canvas Micro (v3)', s.canvasMicroHash.substring(0, 16) + '...');
                    if (s.storageProfileHash) add('Storage (v3)', s.storageProfileHash.substring(0, 16) + '...');

                    document.getElementById('detailsCard').style.display = 'block';
                    document.getElementById('resultSection').classList.add('active');
                } catch (e) {
                    alert('Error: ' + e.message);
                }

                document.getElementById('loading').classList.remove('active');
                document.getElementById('generateBtn').disabled = false;
                document.getElementById('generateFullBtn').disabled = false;
            }

            // Keystroke stats
            document.getElementById('typingArea').addEventListener('input', () => {
                const k = fp.tracker.getKeystroke();
                if (k.rhythm.length) {
                    document.getElementById('keystrokeStats').innerHTML =
                        '<span style="color:#3fb950">Dwell: ' + k.avgDwell.toFixed(0) + 'ms</span> | ' +
                        '<span style="color:#58a6ff">Flight: ' + k.avgFlight.toFixed(0) + 'ms</span> | ' +
                        '<span style="color:#f0883e">WPM: ' + k.wpm.toFixed(0) + '</span>';
                }
            });
        })();
    </script>
</body>

</html>
